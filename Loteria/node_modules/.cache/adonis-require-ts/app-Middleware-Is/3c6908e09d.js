"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const User_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/User"));
class Is {
    async handle({ auth, response }, next, guards) {
        const userId = await auth.user?.id;
        let isNext = false;
        if (userId && guards) {
            const user = await User_1.default.query().where('id', userId).preload('roles').first();
            const userJson = user?.serialize();
            userJson?.roles.forEach(({ name }) => {
                guards.forEach((nameRoleGuard) => {
                    if (name.toLowerCase() === nameRoleGuard.toLowerCase())
                        isNext = true;
                });
            });
        }
        if (isNext)
            return next();
        return response.forbidden({ message: "Your user aren't authorized" });
    }
}
exports.default = Is;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJJcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUVBLGlGQUFrQztBQUNsQyxNQUFxQixFQUFFO0lBQ2QsS0FBSyxDQUFDLE1BQU0sQ0FDakIsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUF1QixFQUN2QyxJQUF5QixFQUN6QixNQUFpQjtRQUdqQixNQUFNLE1BQU0sR0FBRyxNQUFNLElBQUksQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFBO1FBQ2xDLElBQUksTUFBTSxHQUFHLEtBQUssQ0FBQTtRQUVsQixJQUFJLE1BQU0sSUFBSSxNQUFNLEVBQUU7WUFDcEIsTUFBTSxJQUFJLEdBQUcsTUFBTSxjQUFJLENBQUMsS0FBSyxFQUFFLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUE7WUFDNUUsTUFBTSxRQUFRLEdBQUcsSUFBSSxFQUFFLFNBQVMsRUFBRSxDQUFBO1lBRWxDLFFBQVEsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFO2dCQUNuQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsYUFBYSxFQUFFLEVBQUU7b0JBQy9CLElBQUksSUFBSSxDQUFDLFdBQVcsRUFBRSxLQUFLLGFBQWEsQ0FBQyxXQUFXLEVBQUU7d0JBQUUsTUFBTSxHQUFHLElBQUksQ0FBQTtnQkFDdkUsQ0FBQyxDQUFDLENBQUE7WUFDSixDQUFDLENBQUMsQ0FBQTtTQUNIO1FBRUQsSUFBSSxNQUFNO1lBQUUsT0FBTyxJQUFJLEVBQUUsQ0FBQTtRQUV6QixPQUFPLFFBQVEsQ0FBQyxTQUFTLENBQUMsRUFBRSxPQUFPLEVBQUUsNkJBQTZCLEVBQUUsQ0FBQyxDQUFBO0lBQ3ZFLENBQUM7Q0FDRjtBQXpCRCxxQkF5QkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IEh0dHBDb250ZXh0Q29udHJhY3QgfSBmcm9tICdAaW9jOkFkb25pcy9Db3JlL0h0dHBDb250ZXh0J1xuXG5pbXBvcnQgVXNlciBmcm9tICdBcHAvTW9kZWxzL1VzZXInXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBJcyB7XG4gIHB1YmxpYyBhc3luYyBoYW5kbGUoXG4gICAgeyBhdXRoLCByZXNwb25zZSB9OiBIdHRwQ29udGV4dENvbnRyYWN0LFxuICAgIG5leHQ6ICgpID0+IFByb21pc2U8dm9pZD4sXG4gICAgZ3VhcmRzPzogc3RyaW5nW11cbiAgKSB7XG4gICAgLy8gY29kZSBmb3IgbWlkZGxld2FyZSBnb2VzIGhlcmUuIEFCT1ZFIFRIRSBORVhUIENBTExcbiAgICBjb25zdCB1c2VySWQgPSBhd2FpdCBhdXRoLnVzZXI/LmlkXG4gICAgbGV0IGlzTmV4dCA9IGZhbHNlXG5cbiAgICBpZiAodXNlcklkICYmIGd1YXJkcykge1xuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIucXVlcnkoKS53aGVyZSgnaWQnLCB1c2VySWQpLnByZWxvYWQoJ3JvbGVzJykuZmlyc3QoKVxuICAgICAgY29uc3QgdXNlckpzb24gPSB1c2VyPy5zZXJpYWxpemUoKVxuXG4gICAgICB1c2VySnNvbj8ucm9sZXMuZm9yRWFjaCgoeyBuYW1lIH0pID0+IHtcbiAgICAgICAgZ3VhcmRzLmZvckVhY2goKG5hbWVSb2xlR3VhcmQpID0+IHtcbiAgICAgICAgICBpZiAobmFtZS50b0xvd2VyQ2FzZSgpID09PSBuYW1lUm9sZUd1YXJkLnRvTG93ZXJDYXNlKCkpIGlzTmV4dCA9IHRydWVcbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgaWYgKGlzTmV4dCkgcmV0dXJuIG5leHQoKVxuXG4gICAgcmV0dXJuIHJlc3BvbnNlLmZvcmJpZGRlbih7IG1lc3NhZ2U6IFwiWW91ciB1c2VyIGFyZW4ndCBhdXRob3JpemVkXCIgfSlcbiAgfVxufVxuIl19