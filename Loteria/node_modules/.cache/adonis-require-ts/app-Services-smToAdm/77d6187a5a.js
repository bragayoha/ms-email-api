"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.smToAdm = void 0;
const User_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/User"));
const sendMail_1 = require("./sendMail");
const Logger_1 = __importDefault(global[Symbol.for('ioc.use')]("Adonis/Core/Logger"));
async function smToAdm(user) {
    try {
        const adms = await User_1.default.query().whereHas('roles', builder => builder.where('role_id', 1));
        await Promise.all(adms.map(async (adm) => {
            try {
                await (0, sendMail_1.sendMail)(adm, `${user.name} have a new bet!`, 'send_admin_new_bet_email');
                return Logger_1.default.info('Success in send email');
            }
            catch (err) {
                return Logger_1.default.error('Error in send email');
            }
        }));
    }
    catch (error) {
        Logger_1.default.error(error);
    }
}
exports.smToAdm = smToAdm;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic21Ub0FkbS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInNtVG9BZG0udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsaUZBQWtDO0FBQ2xDLHlDQUFxQztBQUNyQyxzRkFBNEM7QUFFckMsS0FBSyxVQUFVLE9BQU8sQ0FBQyxJQUFJO0lBQ2hDLElBQUk7UUFDRixNQUFNLElBQUksR0FBRyxNQUFNLGNBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxRQUFRLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLENBQUUsQ0FBQTtRQUUxRixNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQ2YsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsR0FBRyxFQUFFLEVBQUU7WUFDckIsSUFBRztnQkFDRCxNQUFNLElBQUEsbUJBQVEsRUFBQyxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsSUFBSSxrQkFBa0IsRUFBQywwQkFBMEIsQ0FBQyxDQUFBO2dCQUM5RSxPQUFPLGdCQUFNLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLENBQUE7YUFDNUM7WUFBQyxPQUFPLEdBQUcsRUFBRTtnQkFDWixPQUFPLGdCQUFNLENBQUMsS0FBSyxDQUFDLHFCQUFxQixDQUFDLENBQUE7YUFDM0M7UUFDSCxDQUFDLENBQUMsQ0FDSCxDQUFBO0tBQ0Y7SUFBQyxPQUFPLEtBQUssRUFBRTtRQUNkLGdCQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFBO0tBQ3BCO0FBRUgsQ0FBQztBQWxCRCwwQkFrQkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgVXNlciBmcm9tIFwiQXBwL01vZGVscy9Vc2VyXCJcbmltcG9ydCB7IHNlbmRNYWlsIH0gZnJvbSBcIi4vc2VuZE1haWxcIlxuaW1wb3J0IExvZ2dlciBmcm9tICdAaW9jOkFkb25pcy9Db3JlL0xvZ2dlcidcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNtVG9BZG0odXNlcikge1xuICB0cnkge1xuICAgIGNvbnN0IGFkbXMgPSBhd2FpdCBVc2VyLnF1ZXJ5KCkud2hlcmVIYXMoJ3JvbGVzJywgYnVpbGRlciA9PiBidWlsZGVyLndoZXJlKCdyb2xlX2lkJywgMSkgKVxuXG4gICAgYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICBhZG1zLm1hcChhc3luYyAoYWRtKSA9PiB7XG4gICAgICAgIHRyeXtcbiAgICAgICAgICBhd2FpdCBzZW5kTWFpbChhZG0sIGAke3VzZXIubmFtZX0gaGF2ZSBhIG5ldyBiZXQhYCwnc2VuZF9hZG1pbl9uZXdfYmV0X2VtYWlsJylcbiAgICAgICAgICByZXR1cm4gTG9nZ2VyLmluZm8oJ1N1Y2Nlc3MgaW4gc2VuZCBlbWFpbCcpXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIHJldHVybiBMb2dnZXIuZXJyb3IoJ0Vycm9yIGluIHNlbmQgZW1haWwnKVxuICAgICAgICB9XG4gICAgICB9KVxuICAgIClcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBMb2dnZXIuZXJyb3IoZXJyb3IpXG4gIH1cblxufVxuIl19