"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const Database_1 = __importDefault(global[Symbol.for('ioc.use')]("Adonis/Lucid/Database"));
const runner_1 = require("@japa/runner");
runner_1.test.group('Bet random bets', (group) => {
    group.each.setup(async () => {
        await Database_1.default.beginGlobalTransaction();
        return () => Database_1.default.rollbackGlobalTransaction();
    });
    (0, runner_1.test)('user must be logged in before betting', async ({ client, route }) => {
        const response = await client.post(route('BetsController.store'));
        response.assertStatus(401);
        response.assertBodyContains({
            errors: [{ message: 'E_UNAUTHORIZED_ACCESS: Unauthorized access' }],
        });
    });
    (0, runner_1.test)('bet content isnt provided', async ({ client, route }) => {
        const login = await client.post(route('AuthController.login')).form({
            email: 'admin@example.com',
            password: 'test123',
        });
        const token = login.body().token.token;
        const response = await client.post(route('BetsController.store')).bearerToken(token);
        response.assertStatus(422);
        response.assertBodyContains({
            errors: [
                {
                    rule: 'required',
                    field: 'numbers' || 'game',
                    message: 'required validation failed',
                },
            ],
        });
    });
    (0, runner_1.test)('numbers must be an array', async ({ client, route }) => {
        const login = await client.post(route('AuthController.login')).form({
            email: 'admin@example.com',
            password: 'test123',
        });
        const token = login.body().token.token;
        const response = await client
            .post(route('BetsController.store'))
            .form({ numbers: 'a', game: 1 })
            .bearerToken(token);
        response.assertStatus(422);
        response.assertBodyContains({
            errors: [
                {
                    rule: 'array',
                    field: 'numbers',
                    message: 'array validation failed',
                },
            ],
        });
    });
    (0, runner_1.test)('game must be a game.id and existing game', async ({ client, route }) => {
        const login = await client.post(route('AuthController.login')).form({
            email: 'admin@example.com',
            password: 'test123',
        });
        const token = login.body().token.token;
        const response = await client
            .post(route('BetsController.store'))
            .form({ numbers: [1, 2, 3, 4, 5], game: 'a' })
            .bearerToken(token);
        response.assertStatus(422);
        response.assertBodyContains({
            errors: [
                {
                    rule: 'number',
                    field: 'game',
                    message: 'number validation failed',
                },
                {
                    rule: 'exists',
                    field: 'game',
                    message: 'exists validation failure',
                },
            ],
        });
    });
    (0, runner_1.test)('error in store bet because array isnt valid (just numbers)', async ({ client, route }) => {
        const login = await client.post(route('AuthController.login')).form({
            email: 'admin@example.com',
            password: 'test123',
        });
        const token = login.body().token.token;
        const response = await client
            .post(route('BetsController.store'))
            .form({ numbers: [1, 2, 3, 4, 'a'], game: 1 })
            .bearerToken(token);
        response.assertStatus(422);
        response.assertBodyContains({
            errors: [
                {
                    rule: 'number',
                    field: 'numbers.4',
                    message: 'number validation failed',
                },
            ],
        });
    });
    (0, runner_1.test)('numbers array isnt equal to game minAndMaxNumber', async ({ client, route }) => {
        const login = await client.post(route('AuthController.login')).form({
            email: 'admin@example.com',
            password: 'test123',
        });
        const token = login.body().token.token;
        const response = await client
            .post(route('BetsController.store'))
            .form({ numbers: [1, 2, 3, 4], game: 1 })
            .bearerToken(token);
        response.assertStatus(422);
        response.assertBodyContains({
            errors: [
                {
                    rule: 'minLength' || 'maxLength',
                    field: 'numbers',
                    message: 'minLength validation failed' || 'maxLength validation failed',
                },
            ],
        });
    });
    (0, runner_1.test)('random bet below min cart value', async ({ client, route }) => {
        const login = await client.post(route('AuthController.login')).form({
            email: 'admin@example.com',
            password: 'test123',
        });
        const token = login.body().token.token;
        const response = await client
            .post(route('BetsController.store'))
            .form({ numbers: [1, 2, 3, 4, 5], game: 1, validCart: 30 })
            .bearerToken(token);
        response.assertStatus(422);
        response.assertBodyContains({
            message: 'Total price is below to min cart value',
        });
    });
    (0, runner_1.test)('make sure random bet content is provided', async ({ client, route }) => {
        const login = await client.post(route('AuthController.login')).form({
            email: 'admin@example.com',
            password: 'test123',
        });
        const token = login.body().token.token;
        const response = await client
            .post(route('BetsController.store'))
            .form({
            numbers: [
                Math.floor(Math.random() * 25 + 1),
                Math.floor(Math.random() * 25 + 1),
                Math.floor(Math.random() * 25 + 1),
                Math.floor(Math.random() * 25 + 1),
                Math.floor(Math.random() * 25 + 1),
            ],
            game: 1,
        })
            .bearerToken(token);
        response.assertStatus(2001);
        response.dumpBody();
        response.assertBodyContains([
            {
                user_id: Number,
                game_id: Number,
                numbers: String,
            },
        ]);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmFuZG9tX2JldC5zcGVjLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicmFuZG9tX2JldC5zcGVjLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsMkZBQWlEO0FBQ2pELHlDQUFtQztBQUVuQyxhQUFJLENBQUMsS0FBSyxDQUFDLGlCQUFpQixFQUFFLENBQUMsS0FBSyxFQUFFLEVBQUU7SUFDdEMsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDMUIsTUFBTSxrQkFBUSxDQUFDLHNCQUFzQixFQUFFLENBQUE7UUFFdkMsT0FBTyxHQUFHLEVBQUUsQ0FBQyxrQkFBUSxDQUFDLHlCQUF5QixFQUFFLENBQUE7SUFDbkQsQ0FBQyxDQUFDLENBQUE7SUFFRixJQUFBLGFBQUksRUFBQyx1Q0FBdUMsRUFBRSxLQUFLLEVBQUUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRTtRQUN4RSxNQUFNLFFBQVEsR0FBRyxNQUFNLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQTtRQUVqRSxRQUFRLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBRTFCLFFBQVEsQ0FBQyxrQkFBa0IsQ0FBQztZQUMxQixNQUFNLEVBQUUsQ0FBQyxFQUFFLE9BQU8sRUFBRSw0Q0FBNEMsRUFBRSxDQUFDO1NBQ3BFLENBQUMsQ0FBQTtJQUNKLENBQUMsQ0FBQyxDQUFBO0lBRUYsSUFBQSxhQUFJLEVBQUMsMkJBQTJCLEVBQUUsS0FBSyxFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUU7UUFDNUQsTUFBTSxLQUFLLEdBQUcsTUFBTSxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO1lBQ2xFLEtBQUssRUFBRSxtQkFBbUI7WUFDMUIsUUFBUSxFQUFFLFNBQVM7U0FDcEIsQ0FBQyxD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LEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztnQkFDbEMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztnQkFDbEMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQzthQUNuQztZQUNELElBQUksRUFBRSxDQUFDO1NBQ1IsQ0FBQzthQUNELFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUVyQixRQUFRLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFBO1FBQzNCLFFBQVEsQ0FBQyxRQUFRLEVBQUUsQ0FBQTtRQUNuQixRQUFRLENBQUMsa0JBQWtCLENBQUM7WUFDMUI7Z0JBQ0UsT0FBTyxFQUFFLE1BQU07Z0JBQ2YsT0FBTyxFQUFFLE1BQU07Z0JBQ2YsT0FBTyxFQUFFLE1BQU07YUFDaEI7U0FDRixDQUFDLENBQUE7SUFDSixDQUFDLENBQUMsQ0FBQTtBQUNKLENBQUMsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IERhdGFiYXNlIGZyb20gJ0Bpb2M6QWRvbmlzL0x1Y2lkL0RhdGFiYXNlJ1xuaW1wb3J0IHsgdGVzdCB9IGZyb20gJ0BqYXBhL3J1bm5lcidcblxudGVzdC5ncm91cCgnQmV0IHJhbmRvbSBiZXRzJywgKGdyb3VwKSA9PiB7XG4gIGdyb3VwLmVhY2guc2V0dXAoYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IERhdGFiYXNlLmJlZ2luR2xvYmFsVHJhbnNhY3Rpb24oKVxuXG4gICAgcmV0dXJuICgpID0+IERhdGFiYXNlLnJvbGxiYWNrR2xvYmFsVHJhbnNhY3Rpb24oKVxuICB9KVxuXG4gIHRlc3QoJ3VzZXIgbXVzdCBiZSBsb2dnZWQgaW4gYmVmb3JlIGJldHRpbmcnLCBhc3luYyAoeyBjbGllbnQsIHJvdXRlIH0pID0+IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNsaWVudC5wb3N0KHJvdXRlKCdCZXRzQ29udHJvbGxlci5zdG9yZScpKVxuXG4gICAgcmVzcG9uc2UuYXNzZXJ0U3RhdHVzKDQwMSlcblxuICAgIHJlc3BvbnNlLmFzc2VydEJvZHlDb250YWlucyh7XG4gICAgICBlcnJvcnM6IFt7IG1lc3NhZ2U6ICdFX1VOQVVUSE9SSVpFRF9BQ0NFU1M6IFVuYXV0aG9yaXplZCBhY2Nlc3MnIH1dLFxuICAgIH0pXG4gIH0pXG5cbiAgdGVzdCgnYmV0IGNvbnRlbnQgaXNudCBwcm92aWRlZCcsIGFzeW5jICh7IGNsaWVudCwgcm91dGUgfSkgPT4ge1xuICAgIGNvbnN0IGxvZ2luID0gYXdhaXQgY2xpZW50LnBvc3Qocm91dGUoJ0F1dGhDb250cm9sbGVyLmxvZ2luJykpLmZvcm0oe1xuICAgICAgZW1haWw6ICdhZG1pbkBleGFtcGxlLmNvbScsXG4gICAgICBwYXNzd29yZDogJ3Rlc3QxMjMnLFxuICAgIH0pXG5cbiAgICBjb25zdCB0b2tlbiA9IGxvZ2luLmJvZHkoKS50b2tlbi50b2tlblxuXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQucG9zdChyb3V0ZSgnQmV0c0NvbnRyb2xsZXIuc3RvcmUnKSkuYmVhcmVyVG9rZW4odG9rZW4pXG5cbiAgICByZXNwb25zZS5hc3NlcnRTdGF0dXMoNDIyKVxuXG4gICAgcmVzcG9uc2UuYXNzZXJ0Qm9keUNvbnRhaW5zKHtcbiAgICAgIGVycm9yczogW1xuICAgICAgICB7XG4gICAgICAgICAgcnVsZTogJ3JlcXVpcmVkJyxcbiAgICAgICAgICBmaWVsZDogJ251bWJlcnMnIHx8ICdnYW1lJyxcbiAgICAgICAgICBtZXNzYWdlOiAncmVxdWlyZWQgdmFsaWRhdGlvbiBmYWlsZWQnLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KVxuICB9KVxuXG4gIHRlc3QoJ251bWJlcnMgbXVzdCBiZSBhbiBhcnJheScsIGFzeW5jICh7IGNsaWVudCwgcm91dGUgfSkgPT4ge1xuICAgIGNvbnN0IGxvZ2luID0gYXdhaXQgY2xpZW50LnBvc3Qocm91dGUoJ0F1dGhDb250cm9sbGVyLmxvZ2luJykpLmZvcm0oe1xuICAgICAgZW1haWw6ICdhZG1pbkBleGFtcGxlLmNvbScsXG4gICAgICBwYXNzd29yZDogJ3Rlc3QxMjMnLFxuICAgIH0pXG5cbiAgICBjb25zdCB0b2tlbiA9IGxvZ2luLmJvZHkoKS50b2tlbi50b2tlblxuXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnRcbiAgICAgIC5wb3N0KHJvdXRlKCdCZXRzQ29udHJvbGxlci5zdG9yZScpKVxuICAgICAgLmZvcm0oeyBudW1iZXJzOiAnYScsIGdhbWU6IDEgfSlcbiAgICAgIC5iZWFyZXJUb2tlbih0b2tlbilcblxuICAgIHJlc3BvbnNlLmFzc2VydFN0YXR1cyg0MjIpXG5cbiAgICByZXNwb25zZS5hc3NlcnRCb2R5Q29udGFpbnMoe1xuICAgICAgZXJyb3JzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBydWxlOiAnYXJyYXknLFxuICAgICAgICAgIGZpZWxkOiAnbnVtYmVycycsXG4gICAgICAgICAgbWVzc2FnZTogJ2FycmF5IHZhbGlkYXRpb24gZmFpbGVkJyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSlcbiAgfSlcblxuICB0ZXN0KCdnYW1lIG11c3QgYmUgYSBnYW1lLmlkIGFuZCBleGlzdGluZyBnYW1lJywgYXN5bmMgKHsgY2xpZW50LCByb3V0ZSB9KSA9PiB7XG4gICAgY29uc3QgbG9naW4gPSBhd2FpdCBjbGllbnQucG9zdChyb3V0ZSgnQXV0aENvbnRyb2xsZXIubG9naW4nKSkuZm9ybSh7XG4gICAgICBlbWFpbDogJ2FkbWluQGV4YW1wbGUuY29tJyxcbiAgICAgIHBhc3N3b3JkOiAndGVzdDEyMycsXG4gICAgfSlcblxuICAgIGNvbnN0IHRva2VuID0gbG9naW4uYm9keSgpLnRva2VuLnRva2VuXG5cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNsaWVudFxuICAgICAgLnBvc3Qocm91dGUoJ0JldHNDb250cm9sbGVyLnN0b3JlJykpXG4gICAgICAuZm9ybSh7IG51bWJlcnM6IFsxLCAyLCAzLCA0LCA1XSwgZ2FtZTogJ2EnIH0pXG4gICAgICAuYmVhcmVyVG9rZW4odG9rZW4pXG5cbiAgICByZXNwb25zZS5hc3NlcnRTdGF0dXMoNDIyKVxuXG4gICAgcmVzcG9uc2UuYXNzZXJ0Qm9keUNvbnRhaW5zKHtcbiAgICAgIGVycm9yczogW1xuICAgICAgICB7XG4gICAgICAgICAgcnVsZTogJ251bWJlcicsXG4gICAgICAgICAgZmllbGQ6ICdnYW1lJyxcbiAgICAgICAgICBtZXNzYWdlOiAnbnVtYmVyIHZhbGlkYXRpb24gZmFpbGVkJyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHJ1bGU6ICdleGlzdHMnLFxuICAgICAgICAgIGZpZWxkOiAnZ2FtZScsXG4gICAgICAgICAgbWVzc2FnZTogJ2V4aXN0cyB2YWxpZGF0aW9uIGZhaWx1cmUnLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KVxuICB9KVxuXG4gIHRlc3QoJ2Vycm9yIGluIHN0b3JlIGJldCBiZWNhdXNlIGFycmF5IGlzbnQgdmFsaWQgKGp1c3QgbnVtYmVycyknLCBhc3luYyAoeyBjbGllbnQsIHJvdXRlIH0pID0+IHtcbiAgICBjb25zdCBsb2dpbiA9IGF3YWl0IGNsaWVudC5wb3N0KHJvdXRlKCdBdXRoQ29udHJvbGxlci5sb2dpbicpKS5mb3JtKHtcbiAgICAgIGVtYWlsOiAnYWRtaW5AZXhhbXBsZS5jb20nLFxuICAgICAgcGFzc3dvcmQ6ICd0ZXN0MTIzJyxcbiAgICB9KVxuXG4gICAgY29uc3QgdG9rZW4gPSBsb2dpbi5ib2R5KCkudG9rZW4udG9rZW5cblxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgY2xpZW50XG4gICAgICAucG9zdChyb3V0ZSgnQmV0c0NvbnRyb2xsZXIuc3RvcmUnKSlcbiAgICAgIC5mb3JtKHsgbnVtYmVyczogWzEsIDIsIDMsIDQsICdhJ10sIGdhbWU6IDEgfSlcbiAgICAgIC5iZWFyZXJUb2tlbih0b2tlbilcblxuICAgIHJlc3BvbnNlLmFzc2VydFN0YXR1cyg0MjIpXG5cbiAgICByZXNwb25zZS5hc3NlcnRCb2R5Q29udGFpbnMoe1xuICAgICAgZXJyb3JzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBydWxlOiAnbnVtYmVyJyxcbiAgICAgICAgICBmaWVsZDogJ251bWJlcnMuNCcsXG4gICAgICAgICAgbWVzc2FnZTogJ251bWJlciB2YWxpZGF0aW9uIGZhaWxlZCcsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pXG4gIH0pXG5cbiAgdGVzdCgnbnVtYmVycyBhcnJheSBpc250IGVxdWFsIHRvIGdhbWUgbWluQW5kTWF4TnVtYmVyJywgYXN5bmMgKHsgY2xpZW50LCByb3V0ZSB9KSA9PiB7XG4gICAgY29uc3QgbG9naW4gPSBhd2FpdCBjbGllbnQucG9zdChyb3V0ZSgnQXV0aENvbnRyb2xsZXIubG9naW4nKSkuZm9ybSh7XG4gICAgICBlbWFpbDogJ2FkbWluQGV4YW1wbGUuY29tJyxcbiAgICAgIHBhc3N3b3JkOiAndGVzdDEyMycsXG4gICAgfSlcblxuICAgIGNvbnN0IHRva2VuID0gbG9naW4uYm9keSgpLnRva2VuLnRva2VuXG5cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNsaWVudFxuICAgICAgLnBvc3Qocm91dGUoJ0JldHNDb250cm9sbGVyLnN0b3JlJykpXG4gICAgICAuZm9ybSh7IG51bWJlcnM6IFsxLCAyLCAzLCA0XSwgZ2FtZTogMSB9KVxuICAgICAgLmJlYXJlclRva2VuKHRva2VuKVxuXG4gICAgcmVzcG9uc2UuYXNzZXJ0U3RhdHVzKDQyMilcblxuICAgIHJlc3BvbnNlLmFzc2VydEJvZHlDb250YWlucyh7XG4gICAgICBlcnJvcnM6IFtcbiAgICAgICAge1xuICAgICAgICAgIHJ1bGU6ICdtaW5MZW5ndGgnIHx8ICdtYXhMZW5ndGgnLFxuICAgICAgICAgIGZpZWxkOiAnbnVtYmVycycsXG4gICAgICAgICAgbWVzc2FnZTogJ21pbkxlbmd0aCB2YWxpZGF0aW9uIGZhaWxlZCcgfHwgJ21heExlbmd0aCB2YWxpZGF0aW9uIGZhaWxlZCcsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pXG4gIH0pXG5cbiAgdGVzdCgncmFuZG9tIGJldCBiZWxvdyBtaW4gY2FydCB2YWx1ZScsIGFzeW5jICh7IGNsaWVudCwgcm91dGUgfSkgPT4ge1xuICAgIGNvbnN0IGxvZ2luID0gYXdhaXQgY2xpZW50LnBvc3Qocm91dGUoJ0F1dGhDb250cm9sbGVyLmxvZ2luJykpLmZvcm0oe1xuICAgICAgZW1haWw6ICdhZG1pbkBleGFtcGxlLmNvbScsXG4gICAgICBwYXNzd29yZDogJ3Rlc3QxMjMnLFxuICAgIH0pXG5cbiAgICBjb25zdCB0b2tlbiA9IGxvZ2luLmJvZHkoKS50b2tlbi50b2tlblxuXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnRcbiAgICAgIC5wb3N0KHJvdXRlKCdCZXRzQ29udHJvbGxlci5zdG9yZScpKVxuICAgICAgLmZvcm0oeyBudW1iZXJzOiBbMSwgMiwgMywgNCwgNV0sIGdhbWU6IDEsIHZhbGlkQ2FydDogMzAgfSlcbiAgICAgIC5iZWFyZXJUb2tlbih0b2tlbilcblxuICAgIHJlc3BvbnNlLmFzc2VydFN0YXR1cyg0MjIpXG5cbiAgICByZXNwb25zZS5hc3NlcnRCb2R5Q29udGFpbnMoe1xuICAgICAgbWVzc2FnZTogJ1RvdGFsIHByaWNlIGlzIGJlbG93IHRvIG1pbiBjYXJ0IHZhbHVlJyxcbiAgICB9KVxuICB9KVxuXG4gIHRlc3QoJ21ha2Ugc3VyZSByYW5kb20gYmV0IGNvbnRlbnQgaXMgcHJvdmlkZWQnLCBhc3luYyAoeyBjbGllbnQsIHJvdXRlIH0pID0+IHtcbiAgICBjb25zdCBsb2dpbiA9IGF3YWl0IGNsaWVudC5wb3N0KHJvdXRlKCdBdXRoQ29udHJvbGxlci5sb2dpbicpKS5mb3JtKHtcbiAgICAgIGVtYWlsOiAnYWRtaW5AZXhhbXBsZS5jb20nLFxuICAgICAgcGFzc3dvcmQ6ICd0ZXN0MTIzJyxcbiAgICB9KVxuXG4gICAgY29uc3QgdG9rZW4gPSBsb2dpbi5ib2R5KCkudG9rZW4udG9rZW5cblxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgY2xpZW50XG4gICAgICAucG9zdChyb3V0ZSgnQmV0c0NvbnRyb2xsZXIuc3RvcmUnKSlcbiAgICAgIC5mb3JtKHtcbiAgICAgICAgbnVtYmVyczogW1xuICAgICAgICAgIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDI1ICsgMSksXG4gICAgICAgICAgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMjUgKyAxKSxcbiAgICAgICAgICBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyNSArIDEpLFxuICAgICAgICAgIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDI1ICsgMSksXG4gICAgICAgICAgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMjUgKyAxKSxcbiAgICAgICAgXSxcbiAgICAgICAgZ2FtZTogMSxcbiAgICAgIH0pXG4gICAgICAuYmVhcmVyVG9rZW4odG9rZW4pXG5cbiAgICByZXNwb25zZS5hc3NlcnRTdGF0dXMoMjAwMSlcbiAgICByZXNwb25zZS5kdW1wQm9keSgpXG4gICAgcmVzcG9uc2UuYXNzZXJ0Qm9keUNvbnRhaW5zKFtcbiAgICAgIHtcbiAgICAgICAgdXNlcl9pZDogTnVtYmVyLFxuICAgICAgICBnYW1lX2lkOiBOdW1iZXIsXG4gICAgICAgIG51bWJlcnM6IFN0cmluZyxcbiAgICAgIH0sXG4gICAgXSlcbiAgfSlcbn0pXG4iXX0=